#!/bin/ash
#20230623
#sudo does not work. something to do with busybox mkpasswd now using sha512?
#whatever, if a script has this (ex: /usr/sbin/bootmanager):
# WHOIAM="$(whoami)"
# [ "${WHOIAM}" != "root" ] && exec sudo -A ${0} ${@}
#use busybox 'su' instead. 'su' does not read pw from stdin, but via
#the 'script' utility it works. ref:
# https://stackoverflow.com/questions/19164222/su-pass-password-to-script
#note, /usr/bin/sudo does not have to be suid.

#as this is not the normal sudo executable, perform basic filtering...
if [ "$1" != "-A" ];then
 exit 1
fi
RP="$(realpath "$2" 2>/dev/null)"
if [ ! "${RP}" ];then
 exit 1
fi

shift #need this coz first argument is "-A"
shift #coz have $RP

askpass | script -qc "su root -c '${RP} ${*}' | tail -n +2" /dev/null
