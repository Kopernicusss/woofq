#!/bin/bash
#called from 5populate-rootfs
#enter with $1=generic-name, $2=compat-name, $3=path to expanded pkg
#ex: acl, void, /mnt/wkg/data/woofV/sandbox/acl-1.2.3_1.x86_64
#ex: sysvinit-utils-cut oe /mnt/wkg/data/woofV/sandbox/sysvinit-3.01-r6-nocona-64

Egeneric="$1"
export Ecompatname="$2" #exs: void oe
Pdir="$3"

E1='/mnt/wkg/data/woofV'
L1='/usr/local/woofV'
L2="${L1}/pkg-fix/packages-templates"
[ ! -d ${L2}/${Egeneric} ] && exit 1 #precaution

. ${L1}/configure/DISTRO_SPECS

echo "Applying template fix to ${Pdir##*/}"
cd ${Pdir}
if [ -f ${L2}/${Egeneric}/FIXUPHACK ];then
. ${L2}/${Egeneric}/FIXUPHACK
fi

#20240223 no, now handled in 5populate-rootfs...
#if [ -f ${L2}/${Egeneric}/pinstall.sh ];then
# cp -a -f ${L2}/${Egeneric}/pinstall.sh ${Pdir}/
#fi

if [ "$DISABLE_POST_INSTALL_SCRIPT" == "yes" ];then #this may be in FIXUPHACK
 if [ -f ${Pdir}/INSTALL ];then
  rm -f ${Pdir}/INSTALL
 fi
fi

if [ -d ${L2}/${Egeneric}/REPLACEMENTS ];then
 cp -a -f --remove-destination ${L2}/${Egeneric}/REPLACEMENTS/* ${Pdir}/
fi

